### 实验过程
本次实验基于学生-课程数据库，重点练习连接查询（内连接、外连接）、嵌套查询（相关子查询、非相关子查询）及集合查询的使用，完成多表关联检索、复杂条件筛选和数据统计任务，掌握SQL高级查询技巧。

### 实验详细操作步骤或程序清单
```sql
USE School;

-- （1）查询每个学生及其选课情况（内连接）
SELECT s.*, sc.cno, sc.Grade 
FROM student s
JOIN sc ON s.sno = sc.sno;

-- （2）查询每门课的间接先修课（自连接）
SELECT c1.cno, c2.Cpno AS 间接先修课 
FROM course c1
JOIN course c2 ON c1.Cpno = c2.cno;

-- （3）左外连接查询所有学生及选课情况（含未选课学生）
SELECT s.*, sc.cno, sc.Grade 
FROM student s
LEFT JOIN sc ON s.sno = sc.sno;

-- 右外连接实现（交换表顺序）
SELECT s.*, sc.cno, sc.Grade 
FROM sc
RIGHT JOIN student s ON s.sno = sc.sno;

-- （4）创建成绩等级表并插入数据
CREATE TABLE glevel(
    id TINYINT PRIMARY KEY,
    lowgrade INT NOT NULL,
    highgrade INT NOT NULL
);
INSERT INTO glevel VALUES(1,90,100),(2,80,89),(3,70,79),(4,60,69),(5,0,59);

-- （5）查询每个学生选修成绩的对应等级
SELECT s.sno, s.sname, sc.cno, sc.Grade, g.id AS 等级 
FROM student s
JOIN sc ON s.sno = sc.sno
JOIN glevel g ON sc.Grade BETWEEN g.lowgrade AND g.highgrade;

-- （6）查询每门课程每个成绩等级的人数
SELECT sc.cno, g.id AS 等级, COUNT(s.sno) AS 人数 
FROM sc
JOIN glevel g ON sc.Grade BETWEEN g.lowgrade AND g.highgrade
GROUP BY sc.cno, g.id;

-- （7）查询成绩不及格的学生姓名和所在系
SELECT DISTINCT s.sname, s.sdept 
FROM student s
JOIN sc ON s.sno = sc.sno
WHERE sc.Grade < 60;

-- （8）查询成绩优秀（>90）的学生姓名
SELECT DISTINCT s.sname 
FROM student s
JOIN sc ON s.sno = sc.sno
WHERE sc.Grade > 90;

-- （9）查询既选修2号又选修3号课程的学生姓名、学号
SELECT s.sno, s.sname 
FROM student s
WHERE s.sno IN (
    SELECT sno FROM sc WHERE cno = '002'
) AND s.sno IN (
    SELECT sno FROM sc WHERE cno = '003'
);

-- （10）查询和刘晨同年龄的学生
SELECT * FROM student 
WHERE sage = (SELECT sage FROM student WHERE sname = '刘晨') 
AND sname != '刘晨';

-- （11）选修“数据库”课程的学生姓名和年龄
SELECT s.sname, s.sage 
FROM student s
JOIN sc ON s.sno = sc.sno
JOIN course c ON sc.cno = c.cno
WHERE c.cname = '数据库';

-- （12）其他系比IS系任一学生年龄小的学生
SELECT * FROM student 
WHERE sdept != 'IS' 
AND sage < ANY (SELECT sage FROM student WHERE sdept = 'IS');

-- （13）其他系比IS系所有学生年龄小的学生
SELECT * FROM student 
WHERE sdept != 'IS' 
AND sage < ALL (SELECT sage FROM student WHERE sdept = 'IS');

-- （14）查询选修全部课程的学生姓名
SELECT sname FROM student s
WHERE NOT EXISTS (
    SELECT * FROM course c
    WHERE NOT EXISTS (
        SELECT * FROM sc 
        WHERE sc.sno = s.sno AND sc.cno = c.cno
    )
);

-- （15）查询计算机系且性别为男的学生
SELECT * FROM student 
WHERE sdept = 'CS' AND ssex = '男';

-- （16）选修课程1和课程2学生集合的差（选1不选2）
SELECT sno FROM sc WHERE cno = '001'
EXCEPT
SELECT sno FROM sc WHERE cno = '002';

-- （17）李丽不学的课程号
SELECT cno FROM course 
WHERE cno NOT IN (
    SELECT cno FROM sc 
    WHERE sno = (SELECT sno FROM student WHERE sname = '李丽')
);

-- （18）选修3号课程的学生平均年龄
SELECT AVG(s.sage) AS 平均年龄 
FROM student s
JOIN sc ON s.sno = sc.sno
WHERE sc.cno = '003';

-- （19）每门课程的平均成绩
SELECT cno, AVG(Grade) AS 平均成绩 
FROM sc
GROUP BY cno;

-- （20）统计每门课程选修人数（超3人），按人数降序、课程号升序
SELECT cno, COUNT(sno) AS 选修人数 
FROM sc
GROUP BY cno
HAVING COUNT(sno) > 3
ORDER BY 选修人数 DESC, cno ASC;

-- （21）学号比刘晨大且年龄比他小的学生姓名
SELECT sname FROM student 
WHERE sno > (SELECT sno FROM student WHERE sname = '刘晨')
AND sage < (SELECT sage FROM student WHERE sname = '刘晨');

-- （22）年龄大于女同学平均年龄的男同学姓名和年龄
SELECT sname, sage FROM student 
WHERE ssex = '男' 
AND sage > (SELECT AVG(sage) FROM student WHERE ssex = '女');

-- （23）年龄大于所有女同学年龄的男同学姓名和年龄
SELECT sname, sage FROM student 
WHERE ssex = '男' 
AND sage > (SELECT MAX(sage) FROM student WHERE ssex = '女');

-- （24）至少选修08002全部课程的学生号码
SELECT DISTINCT sno FROM sc sc1
WHERE NOT EXISTS (
    SELECT * FROM sc sc2 
    WHERE sc2.sno = '08002' 
    AND NOT EXISTS (
        SELECT * FROM sc sc3 
        WHERE sc3.sno = sc1.sno AND sc3.cno = sc2.cno
    )
);

-- （25）08001和08002都选修的课程信息
SELECT c.* FROM course c
JOIN sc sc1 ON c.cno = sc1.cno
JOIN sc sc2 ON c.cno = sc2.cno
WHERE sc1.sno = '08001' AND sc2.sno = '08002';
```

### 疑难小结
1. **嵌套查询逻辑复杂**：查询选修全部课程的学生时，需用双层`NOT EXISTS`嵌套，理解“不存在未选修的课程”的逻辑转换较困难。
2. **ANY/ALL运算符混淆**：区分`ANY`（任一）和`ALL`（所有）的语义，如“比IS系任一学生小”用`< ANY`，“比所有小”用`< ALL`。
3. **外连接使用场景**：左外连接保留左表（学生表）全部数据，需明确主表位置，避免遗漏未选课学生。
4. **集合运算限制**：MySQL中`EXCEPT`需用子查询替代（如`NOT IN`），需注意不同数据库的语法差异。

### 实验结果
1. 所有SQL语句均可正确执行，实现多表连接、嵌套查询和集合运算的需求。
2. 掌握内连接、外连接的使用场景，以及`EXISTS`、`ANY`/`ALL`等嵌套查询关键字的用法。
3. 能处理复杂的关联统计需求（如成绩等级分组、课程选修人数筛选），提升SQL高级查询能力。