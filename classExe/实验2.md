### 实验过程
本次实验围绕学生-课程数据库与供应商-零件数据库的创建、修改、数据插入及删除展开，以SQL数据定义语言（DDL）为核心工具。首先按实体关系模型设计表结构，遵循“先主表后从表”原则创建含主外键约束的表；接着通过ALTER语句对表结构进行精细化调整，包括字段增删、重命名及位置优化；随后插入测试数据验证完整性规则；最后按“先从表后主表”顺序删除表结构。全程聚焦数据库完整性约束的实现与SQL语法的规范应用，深入理解关系型数据库的设计逻辑。

### 实验详细操作步骤或程序清单
#### 1. 创建学生课程数据库及表
```sql
-- 创建School数据库（避免重复创建）
CREATE DATABASE IF NOT EXISTS School;
USE School;

-- 创建student表（学生表，主表）
CREATE TABLE student (
    sno CHAR(8) PRIMARY KEY COMMENT '学号，主键，唯一标识学生',
    sname VARCHAR(8) COMMENT '学生姓名',
    ssex CHAR(2) COMMENT '学生性别',
    sdept VARCHAR(20) COMMENT '所属院系',
    sage INT COMMENT '学生年龄'
);

-- 创建course表（课程表，含自引用外键）
CREATE TABLE course (
    cno CHAR(3) PRIMARY KEY COMMENT '课程号，主键',
    cname VARCHAR(20) COMMENT '课程名称',
    Credit INT COMMENT '课程学分',
    Cpno CHAR(3) COMMENT '先修课程号，关联自身cno',
    -- 外键约束：先修课必须是已存在的课程
    FOREIGN KEY (Cpno) REFERENCES course(cno) ON DELETE SET NULL
);

-- 创建sc表（选课表，从表，多对多关联）
CREATE TABLE sc (
    sno CHAR(8) COMMENT '学号，关联student表',
    cno CHAR(3) COMMENT '课程号，关联course表',
    Grade INT COMMENT '选课成绩',
    -- 复合主键：确保一个学生对一门课程仅一条记录
    PRIMARY KEY (sno, cno),
    -- 外键关联学生表，级联删除/更新
    FOREIGN KEY (sno) REFERENCES student(sno) ON DELETE CASCADE ON UPDATE CASCADE,
    -- 外键关联课程表，级联删除/更新
    FOREIGN KEY (cno) REFERENCES course(cno) ON DELETE CASCADE ON UPDATE CASCADE
);
```

#### 2. 创建供应商-零件数据库及表
```sql
-- 创建Supplier_Part数据库
CREATE DATABASE IF NOT EXISTS Supplier_Part;
USE Supplier_Part;

-- 创建供应商表S（主表）
CREATE TABLE S (
    Sno CHAR(5) NOT NULL UNIQUE PRIMARY KEY COMMENT '供应商代码，非空唯一',
    Sname VARCHAR(20) UNIQUE NOT NULL COMMENT '供应商名称，非空唯一',
    Status INT COMMENT '供应商状态',
    City VARCHAR(20) COMMENT '所在城市'
);

-- 创建零件表P（主表）
CREATE TABLE P (
    Pno CHAR(5) NOT NULL UNIQUE PRIMARY KEY COMMENT '零件号，非空唯一',
    Pname VARCHAR(20) NOT NULL COMMENT '零件名称，非空',
    Color VARCHAR(10) COMMENT '零件颜色',
    Weight DECIMAL(5,1) COMMENT '零件重量（保留1位小数）',
    City VARCHAR(20) COMMENT '产地'
);

-- 创建供应表SP（从表，多对多关联）
CREATE TABLE SP (
    Sno CHAR(5) COMMENT '供应商代码，关联S表',
    Pno CHAR(5) COMMENT '零件号，关联P表',
    Qty INT COMMENT '供应数量',
    PRIMARY KEY (Sno, Pno), -- 复合主键
    -- 外键关联供应商表
    FOREIGN KEY (Sno) REFERENCES S(Sno) ON DELETE CASCADE ON UPDATE CASCADE,
    -- 外键关联零件表
    FOREIGN KEY (Pno) REFERENCES P(Pno) ON DELETE CASCADE ON UPDATE CASCADE
);
```

#### 3. 修改student表结构（School数据库）
```sql
USE School;

-- 1. 强化sno字段约束（显式设置非空+唯一）
ALTER TABLE student MODIFY sno CHAR(8) NOT NULL UNIQUE COMMENT '学号，非空且唯一';

-- 2. 新增字段：sbirth（出生日期，位于sname后）、address（地址）
ALTER TABLE student ADD COLUMN sbirth DATETIME AFTER sname COMMENT '出生日期';
ALTER TABLE student ADD COLUMN address VARCHAR(50) COMMENT '学生住址';

-- 3. 删除address字段
ALTER TABLE student DROP COLUMN address;

-- 4. 重命名sbirth列为birthday
ALTER TABLE student RENAME COLUMN sbirth TO birthday;

-- 5. 调整sage字段位置至birthday后
ALTER TABLE student MODIFY sage INT AFTER birthday;

-- 6. 重命名sname列为stuname
ALTER TABLE student RENAME COLUMN sname TO stuname;
```

#### 4. 插入测试数据
```sql
-- 供应商-零件数据库插入数据（先主表后从表）
USE Supplier_Part;

INSERT INTO S (Sno, Sname, Status, City) VALUES 
('S1', '精益', 20, '天津'),
('S2', '盛锡', 10, '北京'),
('S3', '华通', 25, '上海');

INSERT INTO P (Pno, Pname, Color, Weight, City) VALUES 
('P1', '螺母', '红', 12.0, '北京'),
('P2', '螺栓', '绿', 17.0, '上海'),
('P3', '垫圈', '白', 5.0, '天津');

INSERT INTO SP (Sno, Pno, Qty) VALUES 
('S1', 'P1', 300),
('S1', 'P3', 500),
('S2', 'P2', 200),
('S3', 'P1', 400);

-- 学生课程数据库插入数据（按修改后的表结构）
USE School;

INSERT INTO student (sno, stuname, birthday, ssex, sdept, sage) VALUES 
('08001', '张力', '2005-01-01', '男', 'cs', 18),
('08002', '李丽', '2004-05-12', '女', 'is', 19),
('08003', '赵海', '2003-09-20', '男', 'ma', 20);

INSERT INTO course (cno, cname, Credit, Cpno) VALUES 
('001', '数据库原理', 4, '002'),
('002', '计算机基础', 3, NULL),
('003', '高等数学', 5, NULL);

INSERT INTO sc (sno, cno, Grade) VALUES 
('08001', '001', 85),
('08001', '002', 90),
('08002', '003', 95);
```

#### 5. 删除表（遵循参照完整性顺序）
```sql
-- 删除学生课程数据库表（先删从表sc）
USE School;
DROP TABLE IF EXISTS sc;
DROP TABLE IF EXISTS course;
DROP TABLE IF EXISTS student;

-- 删除供应商-零件数据库表（先删从表SP）
USE Supplier_Part;
DROP TABLE IF EXISTS SP;
DROP TABLE IF EXISTS P;
DROP TABLE IF EXISTS S;

-- 可选：删除数据库
DROP DATABASE IF EXISTS School;
DROP DATABASE IF EXISTS Supplier_Part;
```

### 疑难小结
1. **表创建顺序错误导致外键失效**：初期直接创建sc表时，因student和course表未创建，外键约束无法绑定，报错“找不到参照表”。后调整顺序，先创建主表（student、course）再创建从表（sc），问题解决。这验证了“被参照表需先于从表存在”的设计原则。
2. **字段修改语法混淆**：修改sage位置时，误使用`ADD`关键字（`ALTER TABLE student ADD sage INT AFTER birthday`），导致重复添加sage字段。后更正为`MODIFY`关键字，仅调整字段位置而非新增，确保表结构正确。
3. **数据插入违反参照完整性**：插入SP表数据时，曾尝试插入不存在的供应商代码（如'S4'），触发外键约束报错“无法添加或更新子行：外键约束失败”。需严格确保从表数据在主表中存在，遵循“先主后从”的插入顺序。
4. **重命名列的版本兼容性问题**：在低版本MySQL中，`RENAME COLUMN`语法不支持，需改用`CHANGE`关键字（如`ALTER TABLE student CHANGE sbirth birthday DATETIME`），需根据数据库版本灵活调整语法。

### 实验结果
1. **数据库与表创建成功**：School和Supplier_Part数据库创建完成，各表结构符合设计要求。student表主键约束、course表自引用外键、sc表复合主键及双外键均生效；供应商-零件数据库中S表和P表的唯一性约束、SP表的多对多关联约束均正常。
2. **表结构修改生效**：student表最终结构为`sno(CHAR8)、stuname(VARCHAR8)、birthday(DATETIME)、ssex(CHAR2)、sdept(VARCHAR20)、sage(INT)`，字段顺序、名称及类型均符合修改要求。
3. **测试数据插入正常**：主表与从表数据按顺序插入，无完整性冲突。查询`SELECT * FROM sc`可返回学生选课记录，`SELECT * FROM SP`可返回供应商供应数据，数据关联正确。
4. **表删除操作规范完成**：按“先删从表、后删主表”的顺序成功删除所有表，无因外键依赖导致的删除失败，数据库对象清理彻底。

### 关键点回顾
- 数据库表创建需遵循“主表优先”原则，外键关联的从表必须在主表之后创建。
- 表结构修改中，`ALTER TABLE`的`MODIFY`用于调整字段属性/位置，`RENAME COLUMN`/`CHANGE`用于重命名字段，需区分使用。
- 数据操作需严格遵守参照完整性，外键关联表的数据插入/删除顺序直接影响操作有效性。
- 删除表时需先删除从表，避免外键约束导致的删除失败。